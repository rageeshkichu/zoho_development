{% extends 'base.html' %}
{% block content %}
{% load static %}

<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!-- <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" /> -->

<style>
  .modal{
    z-index: 9999;
    overflow: scroll;
  }
  .selectize-input {
    background-color: #000 !important;
    color: white !important;
}

.selectize-input input {
    color: white !important;
}

  /* .form-group{
    width: 40%;
  } */

  .row:after {
    content: "";
    display: table;
    clear: both;
  }
  
  @media screen and (max-width: 600px) {
    .col-25, .col-75, input[type=submit] {
      width: 100%;
      margin-top: 0;
    }

    input[type=text], select, textarea {
      width: 100%;
    }
  }

  .dropdown input,
  .dropdown button {
    
    position: absolute;
    top: 100%;
    left: 0;
  }

  .dropdown.open input,
  .dropdown.open button {
    display: block;
  }

  .row a{
    color: rgb(218, 164, 48);
    font-size: 12px;
  }

  .table th a{
    color:rgb(218, 164, 48);
    font-size: 11px;
    margin-left: 100px;
  }

  ::-webkit-scrollbar {
    display: none;
  }

  ::-webkit-scrollbar-track {
    background: #f1f1f1; 
  }

  ::-webkit-scrollbar-thumb {
    background: #888; 
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #555; 
  }

  .item{
    height: auto;
  }

  .labels{
    color: white; 
    font-size:2.5vh; 
    font-weight: bolder;
  }

  .btn-outline-warning:hover {
    color: black !important;
    font-weight: bold;
  }
  .dropdown-item.customers-options:hover, .dropdown-item.items-options:hover{
    background: white !important;
    color: black !important;
    cursor: pointer;
  }
</style>
<style>
  label{
      color: white;
  }
  .section-3
  {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      margin-top: 1rem;
  }
  .section-3 .section-toggle
  {
      margin-bottom: 0.50rem;
  }
   .section-toggle a
  {

      color: rgb(230, 171, 45);
      font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
      font-size:1.275rem;
  }
  .add_another
  {
     
      color: rgb(230, 171, 45);
  }
  #tbl thead th{
      font-size: 0.785rem;
  }
  @media (max-width:700px)
  {
  .section-3
  {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr ;  

  }
  .section-3 .section-toggle a
  {

      color: rgb(230, 171, 45);
      font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
      font-size:0.875rem;
  }
  }
 


  /* Account Modal */

  .select-box1 {
      position: relative;
      width: 100%;
  }
  

  .select-option1 {
      position: relative;
      
  }

  .select-option1 input {
      width: 100%;
      cursor: pointer;
      background-color: white;
      color: black;
      border-radius: 7px;
      padding: 10px 15px;
      border: 0 !important;
      outline: 0 !important;
  }

  .select-option1:after {
      content: "";
      border-top: 12px solid #000;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      position: absolute;
      right: 15px;
      top: 50%;
      margin-top: -8px;

  }

  .content1 {
      background-color: white;
      position: absolute;
      color: black;
      border-radius: 7px;
      margin-top: 15px;
      width: 100%;
      z-index: 999;
      padding: 20px;
      display: none;
  }

  .search1 input {
      width: 100%;
      font-size: 17px;
      padding: 15px;
      outline: 0;
      border: 1px solid #b3b3b3;
      border-radius: 5px;
  }

  .options1 {
      margin-top: 10px;
      max-height: 150px;
      overflow-y: scroll;
      padding: 0;
  }

  /* .options1::-webkit-scrollbar{
      width: 5px;
     
    } */
  .options1 li {
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      border-bottom: 1px solid gray;
  }

  .select-box1.active .content1 {
      display: block;
  }

  .select-box1.active .select-option1:after {
      transform: rotate(-180deg);
  }
     
</style>

<div class="body-wrapper">
  <div class="container-fluid">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'company_dashboard' %}" class="text-warning-emphasis">Dashboard</a></li>
        <li class="breadcrumb-item"><a class="text-warning-emphasis">E Way Bills</a></li>
        <li class="breadcrumb-item" aria-current="page">Create</li>
      </ol>
    </nav>
      <div class="row mt-5">
          <div class="col-md-12">
            <div class="card mb-5 px-3 py-4" style="background-color: black; border-radius: 1vh;">
              <h1 class="mb-0 text-uppercase text-right" style="color: white; font-weight: bolder;">CREATE E WAY BILL</h1><br>
              <hr class="text-warning">
              <form action="" method="post" enctype="multipart/form-data"id="myForm" onsubmit="return validateForm()">
                {% csrf_token %}
                <div class="row">
                    <div class="row mt-2">
                        <label for="" class="col-md-3 labels">Document Type</label>
                        <div class="col-md-6">
                            <select class="form-control text-white bg-black" id="" name="">
                                <option hidden value="type1">select document type</option>
                                <option value="invoices">Invoices</option>
                                <option value="credit_notes">Credit Notes</option>
                                <option value="delivery_chellans">Delivery Chellans</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mt-2">
                        <label for="" class="col-md-3 labels">Transaction Sub Type</label>
                        <div class="col-md-6">
                            <select class="form-control text-white bg-black" id="" name="">
                                <option value="type1">select Transaction Sub type</option>
                                <option value="supply">Supply</option>
                                <option value="export">Export</option>
                                <option value="skd/ckd">SKD/CKD</option>
                            </select>
                        </div>
                    </div>
                    <h1>Customer details</h1>
                  <div class="col-md-3">
                    <label for="" class="labels">Customer</label>
                    <br>
                    <span class="text-danger" id="custErr"></span>
                  </div>
                  <div class="col-md-6">
                    <input type="hidden" name="customerId" id="customerId" value="">
                    <div class="d-flex">
                        <div class="w-100">
                            <div style="margin-top: 10px;" class="p-0 border-0 bg-none position-relative drop-box">
                                <input required type="text" id="customer" value="" name="customer" class="dropdown-toggle form-control text-white customers-display" onkeyup="filterCustomers()" data-bs-toggle="dropdown" aria-expanded="false" placeholder="Select Customer.." autocomplete="off">
                                <ul class="dropdown-menu w-100 customers-available position-absolute bg-black text-white" id="cust_drop"  style="overflow-y: auto; height: fit-content;max-height: 40vh; border: 1px solid gray;"> 
                                    <li class="dropdown-item customers-options text-white" onclick="getCustomerDetails('','')">Select Customer</li>
                                    {% for cust in customers %}
                                    <li class="dropdown-item customers-options text-white" onclick="getCustomerDetails(`{{cust.id}}`,this.innerHTML)">{{cust.first_name}}</li>
                                    {% endfor %}
                                </ul>
                                
                            </div>
                        </div>
                        <button type="button" data-toggle="modal" data-target="#newCustomer" class="btn btn-outline-warning py-2 ms-1">+</button>
                    </div>
                  </div>
                </div>
                <div class="row mt-2">
                  <label for="" class="col-md-3 labels">Email</label>
                  <div class="col-md-6">
                    <input type="text" class="form-control text-white bg-black" id="customerEmail" name="customer_email" readonly>
                  </div>
                </div>

                <div class="row mt-2">
                  <label for="" class="col-md-3 labels">GST Type</label>
                  <div class="col-md-6">
                    <input type="text" class="form-control text-white bg-black" id="customerGstType" name="customer_gst_type" readonly>
                  </div>
                </div>

                <div class="row mt-2" id="customerGstInDisplay" style="display: flex;">
                  <label for="" class="col-md-3 labels">GSTIN</label>
                  <div class="col-md-6">
                    <input type="text" class="form-control text-white bg-black" id="customerGSTIN" name="customer_gstin" readonly>
                  </div>
                </div>

                <div class="row mt-2" id="billAddressSection">
                  <label for="" class="col-md-3 labels">Billing Address</label>
                  <div class="col-md-6">
                    <textarea class="form-control text-white bg-black" name="bill_address" id="billAddress" rows="4" readonly></textarea>
                  </div>
                </div>

                <div class="row mt-2">
                  <label for="" class="col-md-3 labels">Place of Supply</label>
                  <div class="col-md-6">
                    <input hidden value="{{cmp.state}}" id="cmpstate">
                    <select name="place_of_supply" id="placeOfSupply" class="form-control bg-black text-white">
                      <option value="" selected>Select Place of Supply</option>
                      <option value="[AN]-Andaman And Nicobar Islands">[AN]-Andaman And Nicobar Islands</option>
                      <option value="[AD]-Andhra Pradesh">[AD]-Andhra Pradesh</option>
                      <option value="[AR]-Arunachal Pradesh">[AR]-Arunachal Pradesh	</option> 
                      <option value="volvo">[AS]-Assam</option>
                      <option value="[BR]-Bihar">[BR]-Bihar</option> 
                      <option value="volvo">[CH]-	Chandhigarh</option>
                      <option value="[CG]-Chattisgarh">[CG]-Chattisgarh</option>
                      <option value="[DD]-Daman Diu">[DD]-Daman Diu</option>
                      <option value="volvo">[DL]-	Delhi</option>
                      <option value="[GA]-Goa">[GA]-Goa</option> 
                      <option value="[GJ]-Gujarat">[GJ]-Gujarat</option>
                      <option value="[HR]-Haryana">[HR]-Haryana</option> 
                      <option value="[HP]-Himachal Pradesh">[HP]-Himachal Pradesh</option>
                      <option value="[JK]-Jammu And Kashmir">[JK]-Jammu And Kashmir</option>
                      <option value="[JH]-Jharkand">[JH]-Jharkand</option>
                      <option value="[KA]-Karnataka">[KA]-Karnataka</option>
                      <option value="[KL]-Kerala">[KL]-Kerala</option>
                      <option value="[LA]-Ladakh">[LA]-Ladakh</option>
                      <option value="[LD]-Lakshadweep">[LD]-Lakshadweep</option>
                      <option value="[MP]-Madhyapradesh">[MP]-Madhyapradesh</option>
                      <option value="[MH]-Maharashtra">[MH]-Maharashtra</option>
                      <option value="[MN]-Manipur">[MN]-Manipur</option>  
                      <option value="[ML]-Meghalaya">[ML]-Meghalaya</option>
                      <option value="[MZ]-Mizoram">[MZ]-Mizoram</option>
                      <option value="[NL]-Nagaland">[NL]-Nagaland</option> 
                      <option value="[NL]-Nagaland">[NL]-Nagaland</option>
                      <option value="[OD]-Odisha">[OD]-Odisha</option>
                      <option value="[PY]-Puducherry">[PY]-Puducherry</option>
                      <option value="[PB]-Punjab">[PB]-Punjab.</option>
                      <option value="[RL]-Rajasthan">[RL]-Rajasthan</option>
                      <option value="[SK]-Sikkim">[SK]-Sikkim</option>
                      <option value="[TN]-Tamilnadu">[TN]-Tamilnadu</option>
                      <option value="[TS]-Telenghana">[TS]-Telenghana</option>
                      <option value="[TR]-Tripura">[TR]-Tripura</option>
                      <option value="[UP]-Uttar Pradesh">[UP]-Uttar Pradesh</option>
                      <option value="[UK]-Utharakhand">[UK]-Utharakhand</option>
                      <option value="[WB]-West Bengal">[WB]-West Bengal</option>
                      <option value="[OT]-Other Territory">[OT]-Other Territory</option>
                  </select>
                  </div>
                </div>
                <script>
                    
                    function getCustomerDetails(custId, name){
                        $('#customer').val(name)
                        console.log('name',name);
                        if($('#customer').val() != ""){
                            $('#custErr').text('');
                            $.ajax({
                                type : 'POST',
                                url: "{% url 'getCustomerDetailsAjax' %}",
                                data: {
                                    id: custId,
                                    csrfmiddlewaretoken: '{{ csrf_token }}',
                                },
                                
                                success: function(data){
                                    console.log('AJAX-Response-->',data);
                                    document.getElementById('customerId').value = data.id;
                                    document.getElementById('customerEmail').value = data.email;
                                    document.getElementById('placeOfSupply').value = data.shipState;
                                    document.getElementById('customerGstType').value = data.gstType;
                                    if(data.street == "" && data.city == "" && data.state == ""){
                                        $("#billAddressSection").hide();
                                    }else{
                                        $('#billAddressSection').show();
                                        document.getElementById('billAddress').value = data.street + ',' + data.city + '\n' + data.state + '\n' + data.country  + '\n' + data.pincode ;
                                    }
                                    if(data.gstin){
                                        document.getElementById('customerGstInDisplay').style.display = 'flex';
                                        document.getElementById('customerGSTIN').value = data.gstNo;
                                    }else{
                                        document.getElementById('customerGstInDisplay').style.display = 'none';
                                        document.getElementById('customerGSTIN').value = '';
                                    }
                                    $('#applyPriceList').prop('checked') ? $('#applyPriceList').prop('checked', false) : $('#applyPriceList').prop('checked',false);
                                    refreshTax();
                                    checkPriceList();
                                }
                            });
                        }else{
                            document.getElementById('customerEmail').value = "";
                            document.getElementById('placeOfSupply').value = "";
                            document.getElementById('customerGstType').value = "";
                            document.getElementById('billAddress').value ="";
                            document.getElementById('customerGSTIN').value = "";
                            $('#custErr').text('Select a customer..');
      }
  }
                </script>

                <hr>
                <div class="row mt-2" id="billAddressSection">
                    <label for="" class="col-md-3 labels">E Way Billing Address</label>
                    <div class="col-md-6">
                      <textarea class="form-control text-white bg-black" name="bill_address" id="billAddress" rows="4"></textarea>
                    </div>
                  </div>
                    <div class="row mt-2">
                      <label for="" class="col-md-3 labels">E Way Bill No.</label>
                      <div class="col-md-6">
                        <input type="text" class="form-control bg-black text-white" name="reference_number" value="" readonly>
                      </div>
                    </div>
                  
                  <div class="row mt-2">
                    <div class="col-md-12 mt-2">
                      <div class="row">
                        <label for="" class="col-md-3 labels">Start Date</label>
                        <div class="col-md-6">
                          <input type="date" class="form-control bg-black text-white" id="startDate" name="start_date" value="{% now 'Y-m-d' %}">
                        </div>
                      </div>
                    </div>
                  </div>
                  <hr>
                    <h1>Transportation details</h1>
                        <div class="row mt-2">
                          <label for="" class="col-md-3 labels">Transportation Type</label>
                          <div class="col-md-6">
                            <select class="form-control bg-black text-white" id="entryType" name="entry_type">
                              <option value="">Choose Transportation Type</option>
                              <option value="bus">Bus</option>
                              <option value="train">Train</option>
                              <option value="car">Car</option>
                          </select>
                          </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-12 mt-2">
                              <div class="row">
                                <label for="" class="col-md-3 labels">Kilometers</label>
                                <div class="col-md-6">
                                  <input type="text" class="form-control bg-black text-white" id="" name="" value="">
                                </div>
                              </div>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-12 mt-2">
                              <div class="row">
                                <label for="" class="col-md-3 labels">Vehicle Number</label>
                                <div class="col-md-6">
                                  <input type="text" class="form-control bg-black text-white" id="" name="" value="">
                                </div>
                              </div>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-12 mt-2">
                              <div class="row">
                                <label for="" class="col-md-3 labels">Description</label>
                                <div class="col-md-6">
                                  <input type="text" class="form-control bg-black text-white" id="" name="" value="">
                                </div>
                              </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-12 table-responsive">
                              <table class="table table-bordered" id="invoiceItemsTable">
                                <thead>
                                    <tr>
                                        <th class="text-center text-white" style="width: 3%;">#</th>
                                        <th class="text-center text-white" style="width: 20%;">PRODUCT</th>
                                        <th class="text-center text-white" style="width: 11%;">HSN</th>
                                        <th class="text-center text-white" style="width: 15%;">QTY</th>
                                        <th class="text-center text-white" style="width: 12%;">PRICE</th>
                                        <th class="text-center text-white" style="width: 15%;">TAX (%)</th>
                                        <th class="text-center text-white" style="width: 9%;">DISCOUNT</th>
                                        <th class="text-center text-white" style="width: 12%;">TOTAL</th>
                                        <th style="width: 3%;"></th>
                                    </tr>
                                </thead>
                                <tbody id="items-table-body">
                                    <tr id='tab_row1'>
                                        <td class="nnum  bg-black text-white" style="text-align: center;">1</td>
                                        <td>
                                            <div class="d-flex">
                                                <div class="w-100">
                                                    <div class="p-0 border-0 bg-none position-relative drop-box" style="display: block;">
                                                        <input required type="text" id="item1" value="" name="item_name[]" class="dropdown-toggle form-control text-white item-display" onkeyup="filterFunction($(this).attr('id'))"  data-bs-toggle="dropdown" aria-expanded="false" placeholder="Items.." autocomplete="off">
                                                        <ul class="dropdown-menu w-100 items-available position-absolute bg-black text-white" id="menu1"  style="overflow-y: auto; height: fit-content;max-height: 40vh; border: 1px solid gray;"> 
                                                            {% for i in items %}
                                                            <li class="dropdown-item items-options text-white" onclick="getItemDetails($(this).parent().prev().attr('id'),`{{i.item_name}}`)">{{i.item_name}}</li>
                                                            {% endfor %}
                                                        </ul>
                                                        
                                                    </div>
                                                </div>
                                                <a href="#">
                                                    <button type="button" class="btn btn-outline-warning ms-1" data-target="#newItem" data-toggle="modal">+</button>
                                                </a>
                                            </div>
                                        
                                        </td>
                                        <td>
                                            <input type="hidden" name="item_id[]" id="itemId1">
                                            <input type="text" name='hsn[]' id="hsn1" placeholder='HSN' class="form-control bg-black text-white HSNCODE" readonly />
                                        </td>
                                        <td >
                                            <input type="number" name='qty[]' id="qty1"  class="form-control bg-black text-white qty mb-1" step=0 min=1 value=0 onchange="changeItemQty(this.id)" required/>
                                            <input type="text" id="avl1" style="display: none;">
                                            <div class="d-flex text-white" style="font-size: 0.7rem;"><span>Available Qty:</span><span id="qtyspan1" class=''></span></div>
                                        </td>
                                        <td>
                                            <input type="number" name='price[]' id="price1" class="form-control bg-black text-white price" step="0.00" min="0" style="display: block;" value=0 readonly />
                                            <input type="number" name='priceListPrice[]' id="priceListPrice1" class="form-control bg-black text-white priceListPrice" step="0.00" min="0" style="display: none;" value=0 readonly />
                                        </td>
                                        
                                        <td>
                                            <!-- <input type="text"  id="select_tax" placeholder="Tax Rate" class="form-control seltax d-flex"> -->
                                            <select name='taxGST[]' id="taxGST1" class="form-control bg-black text-white tax_ref tax_ref_gst" style="display: block;" onchange="taxchange(this.id)">
                                                <option selected disabled hidden>Select GST</option>
                                                <option value=28 >28.0% GST</option>
                                                <option value=18 >18.0% GST</option>
                                                <option value=12 >12.0% GST</option>
                                                <option value=5 >05.0% GST</option>
                                                <option value=3 >03.0% GST</option>
                                                <option value=0 >0.0% GST</option>
                                            </select>
                                            <select name='taxIGST[]' id="taxIGST1" class="form-control bg-black text-white tax_ref tax_ref_igst" style="display: none;" onchange="taxchange(this.id)">
                                                <option selected disabled hidden >Select IGST</option>
                                                <option value=28 >28.0% IGST</option>
                                                <option value=18 >18.0% IGST</option>
                                                <option value=12 >12.0% IGST</option>
                                                <option value=5 >05.0% IGST</option>
                                                <option value=3 >03.0% IGST</option>
                                                <option value=0 >0.0% IGST</option>
                                            </select>
                                            <div class="mt-1" style=" text-align: center;color: red;" ><span id="invalidtax1" style="display: none;"> Invalid Tax %</span> </div>    
                                        </td>
                                        <td >
                                            <input type="number" name='discount[]'  placeholder='Enter Discount' id="disc1" value=0 class="form-control bg-black text-white disc" step='any' min=0  />
                                        </td>
            
                                        <td><input type="number" name='total[]' id="total1" class="form-control bg-black text-white total" value=0 readonly /></td>
                                        <td style="display: none;"><input type="hidden" id="taxamount1" class="form-control itemTaxAmount" /></td>
                                        <td>
                                          <i class="fa fa-trash text-danger remove_row" style="cursor: pointer;" title="Remove Row" id="1"></i>
                                        </td>
                                    </tr>
                                </tbody>
                                <tr>
                                    <td colspan="9"><a class="btn btn-outline-warning ms-1" role="button" id="add" >+</a></td>
                                </tr>
                              </table>
                            </div>
                          </div>
            
                        
                
  </div>
</div>

<script>
  
</script>

{%endblock%}